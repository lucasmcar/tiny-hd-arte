function initializeSiteConfig(){let n=document.getElementById("highlightImages"),o=document.getElementById("testimonialsList");var e=document.getElementById("addHighlightImage"),t=document.getElementById("saveSiteConfig"),a=document.querySelectorAll('input[name="showTestimonials"]');let i=document.getElementById("testimonialsSection"),l=document.querySelector('input[name="_csrf_token"]')?.value;l||console.error("Token CSRF não encontrado. Verifique o HTML."),fetch("/admin/site/getHighlights",{method:"GET",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success&&e.highlights&&(n.innerHTML="",e.highlights.forEach(e=>{var t=document.createElement("div");t.className="thumbnail-container col-md-3",t.dataset.id=e.id,t.innerHTML=`
                    <img src="/assets/imgs/uploads/${e.image_url}" class="thumbnail-img" alt="Thumbnail">
                    <div class="thumbnail-details">
                        <input type="text" class="form-control thumbnail-input" placeholder="Texto do Overlay" value="${e.overlay_text}" data-type="overlay">
                        <input type="number" class="form-control thumbnail-input" placeholder="Ordem (1-5)" value="${e.display_order}" min="1" max="5" data-type="order">
                        <button class="remove-btn btn btn-danger">Remover</button>
                    </div>
                `,n.appendChild(t)}))}).catch(e=>console.error("Erro ao carregar highlights:",e)),e.addEventListener("click",()=>{var e,t;5<=n.querySelectorAll(".thumbnail-container").length?alert("Você atingiu o limite máximo de 5 imagens de destaque."):(e=Date.now(),(t=document.createElement("div")).className="thumbnail-container col-md-3",t.dataset.id=e,t.innerHTML=`
            <input type="file" class="form-control thumbnail-input" data-type="image">
            <div class="thumbnail-details">
                <input type="text" class="form-control thumbnail-input" placeholder="Texto do Overlay" data-type="overlay">
                <input type="number" class="form-control thumbnail-input" placeholder="Ordem (1-5)" min="1" max="5" data-type="order">
                <button class="remove-btn btn btn-danger">Remover</button>
            </div>
        `,n.appendChild(t))}),a.forEach(e=>{e.addEventListener("change",()=>{i.style.display="yes"===e.value?"block":"none"})}),fetch("/admin/site/getApprovedTestimonials",{method:"GET",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success&&e.testimonials?(o.innerHTML="",e.testimonials.forEach(e=>{var t=document.createElement("div");t.className="testimonial-item",t.innerHTML=`
                    <input type="checkbox" class="testimonial-checkbox" data-id="${e.id}">
                    <label>${e.titulo}: ${e.depoimento}</label>
                `,o.appendChild(t)}),o.addEventListener("change",e=>{e.target.classList.contains("testimonial-checkbox")&&3<o.querySelectorAll(".testimonial-checkbox:checked").length&&(alert("Você pode selecionar no máximo 3 depoimentos."),e.target.checked=!1)})):o.innerHTML="<p>Nenhum depoimento aprovado disponível.</p>"}).catch(e=>{console.error("Erro ao carregar depoimentos:",e),o.innerHTML="<p>Erro ao carregar depoimentos.</p>"}),n.addEventListener("click",e=>{e.target.classList.contains("remove-btn")&&e.target.parentElement.parentElement.remove()}),t.addEventListener("click",()=>{let a=new FormData;a.append("highlightTitle",document.getElementById("highlightTitle").value),a.append("overlayColor",document.getElementById("overlayColor").value),a.append("showTestimonials","yes"===document.querySelector('input[name="showTestimonials"]:checked').value);var e=Array.from(n.children).map(e=>{var t=e.querySelectorAll(".thumbnail-input"),a=e.querySelector('input[type="file"]'),a=a?a.files[0]:null;return{id:e.dataset.id,image:a,overlayText:t[1].value,order:parseInt(t[2].value)||1}}).filter(e=>e.overlayText),t=(e.forEach((e,t)=>{e.image&&a.append(`highlights[${t}][image]`,e.image),a.append(`highlights[${t}][id]`,e.id),a.append(`highlights[${t}][overlayText]`,e.overlayText),a.append(`highlights[${t}][order]`,e.order)}),Array.from(o.querySelectorAll(".testimonial-checkbox:checked")).map(e=>({id:e.dataset.id})));a.append("testimonials",JSON.stringify(t)),5<e.length?alert("Você excedeu o limite de 5 imagens de destaque. Remova algumas antes de salvar."):3<t.length?alert("Você excedeu o limite de 3 depoimentos. Desmarque alguns antes de salvar."):(a.append("_csrf_token",l),fetch("/admin/configuracoes/site/updateSite",{method:"POST",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},body:a}).then(t=>t.ok?t.json():t.text().then(e=>{throw new Error(`Erro HTTP ${t.status}: `+e)})).then(e=>{e.success?(alert(e.message||"Configurações salvas com sucesso!"),location.reload()):alert(e.message||"Erro ao salvar configurações.")}).catch(e=>{console.error("Erro detalhado:",e),alert("Erro na requisição. Verifique o console.")}),console.log("Configurações salvas:",Object.fromEntries(a)))})}console.log("Script site.min.js carregado com sucesso!"),initializeSiteConfig();