(()=>{var e;console.log("Script carregado em",(new Date).toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"})),e=function(){console.log("DOM carregado em",(new Date).toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"}));let n=document.getElementById("equipeTableBody"),o=document.getElementById("editModal"),a=document.getElementById("deleteModal");var e=document.querySelector("#editModal .close-modal"),t=document.querySelector("#deleteModal .close-modal");let d=document.getElementById("editForm");var r=document.getElementById("confirmDelete"),c=document.getElementById("cancelDelete");let l=document.getElementById("deleteNome");function i(){fetch("/admin/equipe/lista").then(e=>e.json()).then(e=>{e.error?(console.error("Erro ao carregar equipe:",e.error),n.innerHTML='<tr><td colspan="5">Erro ao carregar dados.</td></tr>'):(e=e,n.innerHTML="",e.length?(e.forEach(e=>{var t=document.createElement("tr");t.innerHTML=`
                    <td>${e.nome}</td>
                    <td>${e.cargo}</td>
                    <td>${e.resumo.substring(0,50)}${50<e.resumo.length?"...":""}</td>
                    <td>${e.destaque?"Sim":"Não"}</td>
                    <td>
                        <button class="edit-button" data-id="${e.id}"><i class="bi bi-pencil"></i></button>
                        <button class="delete-button" data-id="${e.id}"><i class="bi bi-trash"></i></button>
                    </td>
                `,n.appendChild(t)}),document.querySelectorAll(".edit-button").forEach(e=>{e.addEventListener("click",u)}),document.querySelectorAll(".delete-button").forEach(e=>{e.addEventListener("click",s)})):n.innerHTML='<tr><td colspan="5">Nenhuma pessoa cadastrada.</td></tr>')}).catch(e=>{console.error("Erro na requisição:",e),n.innerHTML='<tr><td colspan="5">Erro na conexão.</td></tr>'})}function u(e){e=e.target.getAttribute("data-id");fetch("/admin/equipe/editar/"+e).then(e=>e.json()).then(e=>{document.getElementById("editId").value=e.id,document.getElementById("editNome").value=e.nome,document.getElementById("editCargo").value=e.cargo,document.getElementById("editResumo").value=e.resumo,document.getElementById("editFotoAtual").textContent="Imagem atual: "+(e.foto||"Nenhuma"),document.getElementById("editInstagram").value=e.redes?.instagram||"",document.getElementById("editFacebook").value=e.redes?.facebook||"",document.getElementById("editLinkedin").value=e.redes?.linkedin||"",document.getElementById("editDestaque").checked=e.destaque,o.style.display="block"}).catch(e=>console.error("Erro ao carregar dados para edição:",e))}function s(e){let t=e.target.getAttribute("data-id");fetch("/admin/equipe/detalhes/"+t).then(e=>e.json()).then(e=>{l.textContent=e.nome,a.setAttribute("data-id",t),a.style.display="block"}).catch(e=>console.error("Erro ao carregar dados para exclusão:",e))}r.addEventListener("click",function(){var e=a.getAttribute("data-id");fetch("/admin/equipe/excluir/"+e,{method:"DELETE",headers:{"X-CSRF-Token":document.querySelector('input[name="_csrf_token"]').value}}).then(e=>e.json()).then(e=>{e.success?(a.style.display="none",i()):alert(e.error||"Erro ao excluir pessoa.")}).catch(e=>console.error("Erro na exclusão:",e))}),c.addEventListener("click",function(){a.style.display="none"}),e.addEventListener("click",function(){o.style.display="none"}),t.addEventListener("click",function(){a.style.display="none"}),d.addEventListener("submit",function(e){e.preventDefault();var e=document.getElementById("editId").value,t=new FormData(d);fetch("/admin/equipe/atualizar/"+e,{method:"POST",body:t,headers:{"X-CSRF-Token":document.querySelector('input[name="_csrf_token"]').value}}).then(e=>e.json()).then(e=>{e.success?(o.style.display="none",i()):alert(e.error||"Erro ao atualizar pessoa.")}).catch(e=>console.error("Erro na atualização:",e))}),window.addEventListener("click",function(e){e.target===o&&(o.style.display="none"),e.target===a&&(a.style.display="none")}),i()},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,0):document.addEventListener("DOMContentLoaded",e)})();