payButton.addEventListener("click",e=>{e.preventDefault(),document.querySelector("#spinner").style.display="block";e={cliente_nome:document.querySelector('[name="cliente_nome"]').value,cliente_email:document.querySelector('[name="cliente_email"]').value,cliente_cpf:document.querySelector('[name="cliente_cpf"]').value,quantity:hiddenQuantity.value,event_id:document.querySelector('[name="event_id"]').value,event_title:document.querySelector('[name="event_title"]').value};fetch("/criar-pagamento",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.text()).then(t=>{try{var n=JSON.parse(t);if(document.querySelector("#spinner").style.display="none",n.pix.qrcode){document.querySelector(".modal-body").innerHTML+=`
                <div class="pix-payment">
                    <h4>Pagamento via PIX</h4>
                    <img src="${n.pix.qrcode}" alt="QR Code PIX" />
                    <p><strong>Copia e Cola:</strong></p>
                    <textarea readonly style="width:100%;height:80px;">${n.pix.copiaECola}</textarea>
                </div>
            `;let e=n.compraId,t=setInterval(()=>{fetch("/status-pagamento/"+e).then(e=>e.json()).then(e=>{"pago"===e.status&&(document.querySelector("#statusPagamento").innerHTML=`
                            ✅ Pagamento confirmado! 
                            <a href="${e.ingresso}" target="_blank">Baixar ingresso</a>
                        `,clearInterval(t))})},5e3)}}catch(e){console.error("Resposta não-JSON:",t),alert("Erro no servidor, verifique os logs.")}}).catch(e=>{console.error("Erro fetch:",e)})});