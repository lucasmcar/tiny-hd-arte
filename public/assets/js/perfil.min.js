function initializeProfileManagement(){let a=document.getElementById("profile-pic-preview"),n=document.getElementById("profile-pic-upload");var e=document.getElementById("upload-profile-pic"),t=document.getElementById("change-password-btn"),o=document.getElementById("add-admin-btn"),d=document.getElementById("add-email-btn");let r=document.getElementById("new-admin-name"),i=document.getElementById("new-admin-email");var l=document.getElementById("saveProfileBtn");let m=document.getElementById("admins-list"),s=document.getElementById("emails-list"),c=new bootstrap.Modal(document.getElementById("saveProfileModal")),u=document.getElementById("modalMessage"),p=document.querySelector('input[name="_csrf_token"]')?.value;p||console.error("Token CSRF não encontrado. Verifique o HTML."),e.addEventListener("click",()=>n.click()),n.addEventListener("change",()=>{var e,t=n.files[0];t&&t.type.startsWith("image/")&&((e=new FileReader).onload=e=>a.src=e.target.result,e.readAsDataURL(t))}),t.addEventListener("click",()=>{var e=document.getElementById("current-password").value,t=document.getElementById("new-password").value;t!==document.getElementById("confirm-password").value?alert("As senhas não coincidem!"):(console.log("Alterando senha:",{currentPassword:e,newPassword:t}),alert("Senha alterada com sucesso! (Simulação)"))}),o.addEventListener("click",()=>{var e=r.value.trim(),t=i.value.trim();e&&t?(e={nome:e,email:t,funcao:"admin"},(t=document.createElement("div")).className="admin-item",t.dataset.id=Date.now(),t.innerHTML=`<span>${e.nome} (${e.email})</span><button class="remove-btn">Remover</button>`,m.appendChild(t),(e=m.querySelector("div:not(.admin-item)"))&&e.remove(),r.value="",i.value=""):alert("Preencha nome e e-mail.")}),d.addEventListener("click",()=>{var e,t,a=document.getElementById("new-email").value;a?(t=Date.now(),(e=document.createElement("div")).className="email-item",e.dataset.id=t,e.innerHTML=`
                <span>${a}</span>
                <button class="remove-btn">Remover</button>
            `,s.appendChild(e),(t=s.querySelector("div:not(.email-item)"))&&t.remove(),document.getElementById("new-email").value=""):alert("Preencha o e-mail!")}),[m,s].forEach(e=>{e.addEventListener("click",e=>{e.target.classList.contains("remove-btn")&&e.target.parentElement.remove()})}),l.addEventListener("click",()=>{var e={foto_perfil:document.getElementById("profile-pic-preview").src,senha:document.getElementById("new-password").value||void 0,admins:Array.from(m.children).filter(e=>e.classList.contains("admin-item")).map(e=>{var t=e.querySelector("span");return t?(t=t.textContent,{id:e.dataset.id,nome:t.split(" (")[0],email:t.match(/\(([^)]+)\)/)?.[1]||""}):(console.warn("Span não encontrado em um item de admin:",e),null)}).filter(e=>null!==e),emails_empresa:Array.from(s.children).filter(e=>e.classList.contains("email-item")).map(e=>{var t=e.querySelector("span");return t?(t=t.textContent.trim(),{id:e.dataset.id,email:t}):(console.warn("Span não encontrado em um item de email:",e),null)}).filter(e=>null!==e),nome_exibicao:document.getElementById("display-name").value,admin_name:document.getElementById("admin-name").value,admin_email:document.getElementById("admin-email").value};u.textContent="Salvando dados...",c.show(),fetch("/admin/profile/updateProfile",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({...e,_csrf_token:p})}).then(t=>t.ok?t.json():t.text().then(e=>{throw new Error(`Erro HTTP ${t.status}: `+e)})).then(e=>{console.log("Resposta do backend:",e),e.success?(u.textContent=e.message||"Perfil salvo com sucesso!",u.style.color="#e0e0e0",s.innerHTML="",e.data.emails_empresa&&0<e.data.emails_empresa.length?(console.log("E-mails a renderizar:",e.data.emails_empresa),e.data.emails_empresa.forEach(e=>{var t=document.createElement("div");t.className="email-item",t.dataset.id=e.id,t.innerHTML=`<span>${e.email}</span><button class="remove-btn">Remover</button>`,s.appendChild(t)})):(console.log("Nenhum e-mail retornado para renderizar."),s.innerHTML="<div>Não há e-mails cadastrados</div>"),m.innerHTML="",e.data.admins&&0<e.data.admins.length?(console.log("Administradores a renderizar:",e.data.admins),e.data.admins.forEach(e=>{var t=document.createElement("div");t.className="admin-item",t.dataset.id=e.id,t.innerHTML=`<span>${e.nome} (${e.email})</span><button class="remove-btn">Remover</button>`,m.appendChild(t)})):(console.log("Nenhum administrador retornado para renderizar."),m.innerHTML="<div>Não há administradores cadastrados para esse perfil</div>")):(u.textContent=e.message||"Erro ao salvar o perfil.",u.style.color="#ff4d4d"),setTimeout(()=>c.hide(),2e3)}).catch(e=>{u.textContent="Erro na requisição: "+e.message,u.style.color="#ff4d4d",console.error("Erro detalhado:",e),setTimeout(()=>c.hide(),2e3)}),console.log("Perfil salvo:",e)})}console.log("Script gerenciar-perfil.js carregado com sucesso!"),initializeProfileManagement();