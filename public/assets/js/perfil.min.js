function initializeProfileManagement(){let n=document.getElementById("profile-pic-preview"),a=document.getElementById("profile-pic-upload");var e=document.getElementById("upload-profile-pic"),t=document.getElementById("change-password-btn"),l=document.getElementById("add-admin-btn"),o=document.getElementById("add-email-btn");let i=document.getElementById("new-admin-name"),d=document.getElementById("new-admin-email"),m=document.getElementById("new-admin-senha");var r=document.getElementById("saveProfileBtn");let s=document.getElementById("admins-list"),c=document.getElementById("emails-list"),u=new bootstrap.Modal(document.getElementById("saveProfileModal")),v=document.getElementById("modalMessage"),p=document.querySelector('input[name="_csrf_token"]')?.value;p||console.error("Token CSRF não encontrado. Verifique o HTML."),e.addEventListener("click",()=>a.click()),a.addEventListener("change",()=>{var e,t=a.files[0];t&&t.type.startsWith("image/")&&((e=new FileReader).onload=e=>n.src=e.target.result,e.readAsDataURL(t))}),t.addEventListener("click",()=>{document.getElementById("current-password").value;document.getElementById("new-password").value!==document.getElementById("confirm-password").value?alert("As senhas não coincidem!"):alert("Senha alterada com sucesso! (Simulação)")}),l.addEventListener("click",()=>{var e=i.value.trim(),t=d.value.trim(),n=m.value.trim();e&&t?(e={nome:e,email:t,senha:n||void 0},(t=document.createElement("div")).className="admin-item",t.dataset.id=Date.now(),t.innerHTML=`
                <span>${e.nome} (${e.email})</span>
                <button class="remove-btn">Remover</button>
            `,s.appendChild(t),(n=s.querySelector("div:not(.admin-item)"))&&n.remove(),i.value="",d.value="",m.value=""):alert("Preencha nome e e-mail.")}),o.addEventListener("click",()=>{var e,t=document.getElementById("new-email").value.trim();t?((e=document.createElement("div")).className="email-item",e.dataset.id=Date.now(),e.innerHTML=`<span>${t}</span><button class="remove-btn">Remover</button>`,c.appendChild(e),(t=c.querySelector("div:not(.email-item)"))&&t.remove(),document.getElementById("new-email").value=""):alert("Preencha o e-mail!")}),[s,c].forEach(e=>{e.addEventListener("click",e=>{e.target.classList.contains("remove-btn")&&e.target.parentElement.remove()})}),r.addEventListener("click",()=>{var e={nome_exibicao:document.getElementById("display-name").value,admin_name:document.getElementById("admin-name").value,admin_email:document.getElementById("admin-email").value,foto_perfil:document.getElementById("profile-pic-preview").src,admins:Array.from(s.children).filter(e=>e.classList.contains("admin-item")).map(e=>{var t,n=e.querySelector("span");return n?([n,t]=n.textContent.split(" ("),t=t?t.replace(")",""):"",{id:e.dataset.id,nome:n,email:t}):null}).filter(e=>null!==e),emails_empresa:Array.from(c.children).filter(e=>e.classList.contains("email-item")).map(e=>{var t=e.querySelector("span");return t?{id:e.dataset.id,email:t.textContent.trim()}:null}).filter(e=>null!==e)};v.textContent="Salvando dados...",u.show(),fetch("/admin/profile/updateProfile",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({...e,_csrf_token:p})}).then(e=>{if(e.ok)return e.json();throw new Error("Erro HTTP "+e.status)}).then(e=>{e.success?(v.textContent=e.message||"Perfil salvo com sucesso!",v.style.color="#e0e0e0"):(v.textContent=e.message||"Erro ao salvar o perfil.",v.style.color="#ff4d4d"),setTimeout(()=>u.hide(),2e3)}).catch(e=>{v.textContent="Erro na requisição: "+e.message,v.style.color="#ff4d4d",console.error("Erro detalhado:",e),setTimeout(()=>u.hide(),2e3)})})}initializeProfileManagement();