document.addEventListener("DOMContentLoaded",function(){if("/admin/login"===window.location.pathname)fabToggle.setAttribute("hidden"),(d=document.getElementById("session-timer"))&&d.classList.add("hidden");else if(isLoggedIn&&0!==tokenExpiry){let e=document.getElementById("timer"),t=document.getElementById("modal-timer"),a=new bootstrap.Modal(document.getElementById("session-expiry-modal"),{backdrop:"static",keyboard:!1});var d=Math.floor(Date.now()/1e3);let n=tokenExpiry-d,o=!1,i,r=setInterval(()=>{if(n--,e.textContent=u(n),300===n){a.show();let e=300;i=setInterval(()=>{e--,t.textContent=u(e),e<=0&&clearInterval(i)},1e3)}n<=0&&(clearInterval(r),o||(o=!0,fetch("/admin/logout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('input[name="_csrf_token"]')?.value}}).then(e=>e.json()).then(e=>{e.success?(localStorage.removeItem("jwt"),sessionStorage.removeItem("jwt")):console.error("Erro ao fazer logout:",e.message),window.location.href="/admin/login?loggedOut=true"}).catch(e=>{console.error("Erro ao fazer logout:",e),window.location.href="/admin/login?loggedOut=true"})))},1e3),l=(e.textContent=u(n),document.getElementById("sidebar")),s=document.getElementById("toggle-sidebar"),c=document.getElementById("main-content");function u(e){var t=Math.floor(e/3600),a=Math.floor(e%3600/60),e=e%60;return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:`+e.toString().padStart(2,"0")}s.addEventListener("click",()=>{l.classList.toggle("active"),c.classList.toggle("shifted"),s.setAttribute("aria-expanded",l.classList.contains("active"))}),document.querySelectorAll(".accordion-toggle").forEach(a=>{a.addEventListener("click",e=>{e.preventDefault();var e=a.nextElementSibling,t=e.classList.contains("active");document.querySelectorAll(".accordion-menu").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".accordion-toggle").forEach(e=>e.classList.remove("active")),t||(a.classList.add("active"),e.classList.add("active")),a.setAttribute("aria-expanded",!t)})})}else(d=document.getElementById("session-timer"))&&d.classList.add("hidden")});let menuData=[{label:"Dashboard",icon:"bi-house-door",route:"/admin/dashboard"},{label:"Consultoria",icon:"bi-briefcase",submenu:[{label:"Cadastro",route:"/admin/consultoria"},{label:"Registros",route:"/admin/consultoria/lista"}]},{label:"Equipe",icon:"bi-person-vcard-fill",submenu:[{label:"Cadastro",route:"/admin/equipe/cadastro"},{label:"Registros",route:"/admin/equipe/lista"}]},{label:"Destão de Projetos",icon:"bi-tools",submenu:[{label:"Cadastros",icon:"bi-clipboard-data",route:"/admin/projetos-culturais"},{label:"Registros",icon:"bi-list",route:"/admin/projetos-culturais/listaProjetos"},{label:"Projetos Em Captação",icon:"bi-plus-circle",route:"/admin/projetos-captacao"}]}],isSidebarOpen=!1;function initFAB(){var e=document.getElementById("fab-menu-toggle");let t=document.getElementById("fab-sidebar"),a=document.getElementById("fab-icon");e&&t&&a&&(e.hasAttribute("data-listener")||(e.setAttribute("data-listener","true"),e.addEventListener("click",()=>{isSidebarOpen=!isSidebarOpen,t.classList.toggle("open",isSidebarOpen),t.setAttribute("aria-hidden",!isSidebarOpen),a.className=isSidebarOpen?"bi bi-x":"bi bi-list"})))}function createMenu(){let a=document.getElementById("fab-menu-items");a.innerHTML="",menuData.forEach(e=>{var t=document.createElement("li");e.submenu?t.innerHTML=`
                <a href="#" class="menu-item has-submenu">
                    <i class="${e.icon}"></i>
                    ${e.label}
                    <span class="submenu-toggle">+</span>
                </a>
                <ul class="submenu">
                    ${e.submenu.map(e=>`
                        <li>
                            <a href="${e.route}" class="ajax-link">
                                <i class="${e.icon||""}"></i> ${e.label}
                            </a>
                        </li>
                    `).join("")}
                </ul>
            `:t.innerHTML=`
                <a href="${e.route}" class="menu-item ajax-link">
                    <i class="${e.icon}"></i>
                    ${e.label}
                </a>
            `,a.appendChild(t)}),attachAjaxHandlers()}function attachAjaxHandlers(){document.querySelectorAll(".ajax-link").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("href");e&&(loadPage(e),history.pushState({path:e},"",e))})})}function loadPage(e){fetch(e).then(e=>{if(e.ok)return e.text();throw new Error("Erro ao carregar página")}).then(e=>{var e=(new DOMParser).parseFromString(e,"text/html").querySelector("#main-content"),t=document.querySelector("#main-content");e&&t&&(t.innerHTML=e.innerHTML,window.scrollTo(0,0),attachAjaxHandlers())}).catch(e=>{console.error(e),document.querySelector("#main-content").innerHTML="<p>Erro ao carregar conteúdo.</p>"})}window.addEventListener("popstate",function(e){e.state&&e.state.path&&loadPage(e.state.path)}),document.addEventListener("DOMContentLoaded",()=>{var e;"/admin/login"!==window.location.pathname&&"/login"!==window.location.pathname||(e=document.getElementById("fab-sidebar"))&&e.setAttribute("hidden",!0),createMenu(),initFAB()});