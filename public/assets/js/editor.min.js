function initializeEditor(){let o=document.getElementById("content"),i=document.querySelectorAll(".toolbar-btn"),r=document.getElementById("heading-select");var e=document.getElementById("image-upload-btn");let t=document.getElementById("image-upload"),l=document.getElementById("image-preview"),d={bold:!1,italic:!1,underline:!1,insertUnorderedList:!1,insertOrderedList:!1,paragraph:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1};function c(t){var n=window.getSelection();if(n.rangeCount){let e=n.getRangeAt(0).commonAncestorContainer;for(;e&&e!==o;){if(1===e.nodeType&&e.tagName.toLowerCase()===t)return!0;e=e.parentNode}}return!1}function s(){var e=window.getSelection();let a=e.rangeCount&&!e.getRangeAt(0).collapsed;i.forEach(e=>{var t,n=e.getAttribute("data-command"),i=e.getAttribute("data-align");n?a?(t=c({bold:"b",italic:"i",underline:"u",insertUnorderedList:"ul",insertOrderedList:"ol",paragraph:"p"}[n]),e.classList.toggle("active",t)):e.classList.toggle("active",d[n]):i&&(t="align"+(i.charAt(0).toUpperCase()+i.slice(1)),a?(n=(()=>{var t=window.getSelection();if(t.rangeCount){let e=t.getRangeAt(0).commonAncestorContainer;for(;e&&e!==o;){if(1===e.nodeType&&e.style.textAlign)return e.style.textAlign;e=e.parentNode}}return"left"})(),e.classList.toggle("active",n===i)):e.classList.toggle("active",d[t]))});var t;let n="";for(t of["h1","h2","h3","h4","h5","h6"])if(c(t)){n=t;break}r.value=n||""}i.forEach(e=>{let a=e.getAttribute("data-command"),t=e.getAttribute("data-align");a?e.addEventListener("click",function(e){e.preventDefault();e=a;if((t=window.getSelection()).rangeCount){var t=t.getRangeAt(0),n={bold:"b",italic:"i",underline:"u",insertUnorderedList:"ul",insertOrderedList:"ol",paragraph:"p"}[e];if(t.collapsed)d[e]=!d[e];else if(c(n)){let e=t.commonAncestorContainer;for(;e&&e!==o;){if(1===e.nodeType&&e.tagName.toLowerCase()===n){for(var i=e.parentNode;e.firstChild;)i.insertBefore(e.firstChild,e);i.removeChild(e);break}e=e.parentNode}}else{e=document.createElement(n);t.surroundContents(e)}o.focus(),s()}}):t&&e.addEventListener("click",function(n){n.preventDefault();n=t;if((a=window.getSelection()).rangeCount){let t="align"+(n.charAt(0).toUpperCase()+n.slice(1));d[t]=!d[t];["alignLeft","alignCenter","alignRight","alignJustify"].forEach(e=>{e!==t&&(d[e]=!1)});var i,a=a.getRangeAt(0);let e=a.commonAncestorContainer;for(;e&&e!==o&&!["P","H1","H2","H3","H4","H5","H6","DIV"].includes(e.tagName);)e=e.parentNode;e&&e!==o?e.style.textAlign=d[t]?n:"":d[t]&&((i=document.createElement("p")).style.textAlign=n,a.surroundContents(i)),o.focus(),s()}})}),r&&r.addEventListener("change",function(){var t=this.value;if((a=window.getSelection()).rangeCount){var n,i,a=a.getRangeAt(0);let e=a.commonAncestorContainer;for(;e&&e!==o&&!["H1","H2","H3","H4","H5","H6","P"].includes(e.tagName);)e=e.parentNode;e&&e!==o?(i=e.parentNode,n=t?document.createElement(t):document.createTextNode(e.textContent),t&&(n.textContent=e.textContent),i.replaceChild(n,e)):t&&(i=document.createElement(t),a.surroundContents(i)),o.focus(),s()}this.blur()}),document.getElementById("link-btn").addEventListener("click",function(e){e.preventDefault();var t,n,e=prompt("Digite a URL do link:");e&&((t=window.getSelection()).rangeCount&&(t=t.getRangeAt(0),(n=document.createElement("a")).href=e,n.textContent=t.toString()||"Link",t.deleteContents(),t.insertNode(n)),o.focus(),s())}),e&&t?(e.addEventListener("click",function(){t.click()}),t.addEventListener("change",function(){var e=this.files;e&&0<e.length&&Array.from(e).forEach(i=>{var e;i.type.startsWith("image/")?((e=new FileReader).onload=function(e){var t=document.createElement("img"),n=(t.src=e.target.result,t.alt=i.name,t.classList.add("preview-img"),t.style.maxWidth="200px",document.createElement("div"));n.classList.add("preview-container"),n.appendChild(t),l.appendChild(n);let a=document.createElement("img");a.src=e.target.result,a.alt=i.name,a.classList.add("resizable-img"),a.style.maxWidth="200px",a.contentEditable=!1,a.draggable=!0,a.addEventListener("mousedown",function(e){if(e.ctrlKey){e.preventDefault();let t=e.clientX,n=a.offsetWidth;function i(e){e=n+(e.clientX-t);a.style.maxWidth=e+"px"}document.addEventListener("mousemove",i),document.addEventListener("mouseup",function e(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e)})}}),o.appendChild(a)},e.readAsDataURL(i)):console.warn("Arquivo não é uma imagem:",i.name)})})):console.warn("Elementos de upload de imagem não encontrados."),o.addEventListener("input",function(e){var t,n,i=window.getSelection();i.rangeCount&&(i=i.getRangeAt(0),"insertText"!==e.inputType&&"insertLineBreak"!==e.inputType||i.collapsed&&(d.bold||d.italic||d.underline)&&3===(e=i.startContainer).nodeType&&e.parentNode!==o&&(t=(e=>{let t=e;return d.underline&&((e=document.createElement("u")).appendChild(t),t=e),d.italic&&((e=document.createElement("i")).appendChild(t),t=e),d.bold&&((e=document.createElement("b")).appendChild(t),t=e),t})(e))!==e&&((n=e.parentNode).insertBefore(t,e.nextSibling),n.removeChild(e),i.setStart(t,t.textContent.length),i.setEnd(t,t.textContent.length)),s())}),document.addEventListener("selectionchange",()=>{document.activeElement===o&&s()})}initializeEditor();