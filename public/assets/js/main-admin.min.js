document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".top-navbar");"/admin/login"===window.location.pathname&&(e.style.display="none"),document.getElementById("sidebar");let r=document.getElementById("main-content");document.getElementById("toggle-sidebar");let c=[],i=[];function n(){var e=document.getElementById("sidebar"),t=document.getElementById("main-content");e&&t?(e.classList.toggle("active"),t.classList.toggle("shifted"),console.log(e.classList.contains("active")?"Sidebar aberto":"Sidebar fechado")):console.error("Elementos do sidebar não encontrados durante toggle:",{sidebar:e,mainContent:t})}function l(){var e=document.getElementById("sidebar"),t=document.getElementById("main-content");e&&t&&e.classList.contains("active")&&(e.classList.remove("active"),t.classList.remove("shifted"),console.log("Sidebar fechado"))}function s(){var e=document.getElementById("toggle-sidebar"),t=document.getElementById("sidebar"),o=document.getElementById("main-content");e&&t&&o?(e.removeEventListener("click",n),e.addEventListener("click",n),console.log("Eventos do sidebar reconfigurados com sucesso")):(console.warn("Elementos do sidebar não encontrados. Tentando novamente em 100ms...",{toggleButton:e,sidebar:t,mainContent:o}),setTimeout(s,100))}function d(){document.querySelectorAll(".nav-link:not(.accordion-toggle)").forEach(e=>{e.removeEventListener("click",o),e.addEventListener("click",o),console.log("Listener de navegação adicionado ao link:",e.textContent)}),document.removeEventListener("click",a),document.addEventListener("click",a)}function m(){document.querySelectorAll(".accordion-toggle").forEach(e=>{e.removeEventListener("click",t),e.addEventListener("click",t),console.log("Listener de acordeão adicionado ao item:",e.textContent)})}function t(e){e.preventDefault(),e.stopPropagation();let t=this.nextElementSibling;e=t.classList.contains("active");console.log("Estado atual do submenu antes de alternar:",e?"Ativo":"Inativo"),document.querySelectorAll(".accordion-menu").forEach(e=>{e!==t&&(e.classList.remove("active"),e.previousElementSibling.classList.remove("active"),e.style.maxHeight="0",console.log("Fechando outro submenu:",e.previousElementSibling.textContent))}),e?(t.classList.remove("active"),this.classList.remove("active"),t.style.maxHeight="0",console.log("Submenu fechado:",this.textContent)):(t.classList.add("active"),this.classList.add("active"),t.style.maxHeight=t.scrollHeight+"px",console.log("Submenu aberto:",this.textContent)),console.log("Estado final do submenu após alternar:",t.classList.contains("active")?"Ativo":"Inativo")}function o(e){e.preventDefault();e=e.currentTarget.getAttribute("data-page");e&&(console.log("Carregando página:",e),h("/admin/"+e),l())}function a(e){var t=e.target.closest("[data-url]");t&&(e.preventDefault(),e=t.getAttribute("data-url"),console.log("Clique detectado em elemento com data-url:",e),h(e),l())}let u=[],g=!1;function v(e,t){u.push({src:e,callback:t}),function o(){if(!g&&0!==u.length){g=!0;let{src:e,callback:t}=u.shift();var n;document.querySelector(`script[src="${e}"]`)?(console.log("Script já carregado anteriormente: "+e),t(),g=!1,o()):(console.log("Iniciando carregamento do script: "+e),(n=document.createElement("script")).src=e,n.onload=()=>{console.log("Script carregado com sucesso: "+e),t(),g=!1,o()},n.onerror=()=>{console.error("Erro ao carregar script: "+e),g=!1,o()},n.dataset.dynamic="true",document.body.appendChild(n))}}()}function h(a){document.getElementById("loading").style.display="block",fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>(console.log("Resposta da página:",e.status),e.text())).then(o=>{var o=(new DOMParser).parseFromString(o,"text/html"),n=o.querySelector("main");if(n){r.innerHTML=n.innerHTML,console.log("Conteúdo carregado no main-content"),s(),d(),m();n=Array.from(o.querySelectorAll('link[rel="stylesheet"]')).map(e=>e.getAttribute("href"));let e=Array.from(o.querySelectorAll("script[src]")).map(e=>e.getAttribute("src")),t=(document.querySelectorAll('link[data-dynamic="true"]').forEach(e=>{e.remove(),console.log("Estilo removido: "+e.href)}),document.querySelectorAll('script[data-dynamic="true"]').forEach(e=>{e.remove(),console.log("Script removido: "+e.src)}),n.forEach(e=>{return t=e,document.querySelector(`link[href="${t}"]`)?document.querySelector(`link[href="${t}"]`):((e=document.createElement("link")).rel="stylesheet",e.href=t,e.onload=()=>console.log("Estilo carregado: "+t),e.onerror=()=>console.error("Erro ao carregar estilo: "+t),e.dataset.dynamic="true",document.head.appendChild(e),e);var t}),()=>{e.includes("http://localhost:8000/assets/js/tiny-init.js")&&(console.log("Scripts carregados. Inicializando TinyMCE manualmente..."),"function"==typeof window.initializeTinyMCEOnDynamicLoad?window.initializeTinyMCEOnDynamicLoad():(console.warn("Função initializeTinyMCEOnDynamicLoad ainda não disponível. Tentando novamente em 100ms..."),setTimeout(t,100)))});e.forEach(e=>v(e,t)),c=n,i=e,"/admin/home"===a&&(l(),y())}document.getElementById("loading").style.display="none"}).catch(e=>{console.error("Erro ao carregar a página:",e),document.getElementById("loading").style.display="none"})}function y(){var e=document.querySelectorAll(".metric");0===e.length?console.warn("Nenhum elemento .metric encontrado no DOM."):e.forEach(e=>{let t=parseInt(e.getAttribute("data-value"),10),o=(e.textContent="0",0);var n=Math.abs(Math.floor(300/(t||1)));e.counter&&clearInterval(e.counter),e.counter=setInterval(()=>{o+=1,(e.textContent=o)>=t&&(e.textContent=t,clearInterval(e.counter))},n)})}function f(e){e.preventDefault();e=document.querySelector('input[name="_csrf_token"]')?.value;e?fetch("/admin/logout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({_csrf_token:e})}).then(e=>{if(e.ok)return e.text();throw new Error("Erro HTTP: "+e.status)}).then(t=>{try{var e=JSON.parse(t);e.success?(console.log("Logout realizado com sucesso:",e.message),window.location.href="/admin/login"):console.error("Erro no logout:",e.message)}catch(e){console.error("Resposta não é JSON válida:",t,e),window.location.href="/admin/login"}}).catch(e=>{console.error("Erro ao fazer logout:",e),window.location.href="/admin/login"}):console.error("Token CSRF não encontrado.")}s(),d(),m(),l();e=document.querySelector('a[href="/admin/logout"]');e&&(e.removeEventListener("click",f),e.addEventListener("click",f),console.log("Listener de logout adicionado ao link:",e.textContent)),"/admin/home"===window.location.pathname&&(l(),y());let E=!1;new MutationObserver(e=>{e.forEach(()=>{document.querySelector(".dashboard-grid")&&!E&&(E=!0,l(),y(),setTimeout(()=>{E=!1},2500))})}).observe(r,{childList:!0,subtree:!0})});